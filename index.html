<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>
        子图匹配
    </title>
    <!-- 引入 echarts.js -->
    <style>
    .title {
        font-size: 30px;
        text-align: center;
    }
    
    input {
        display: inline;
        width: 30px;
    }
    
    select {
        display: inline;
        width: 100px;
    }
    
    #charts {
        background-color:#eeeeee;
        margin-top: 50px;
    }
    .chart {
        display: inline-block;
        left:100px;
        top:30%;
    }
    .first{
        display: inline-block;
    }
    .show_q {
        position:relative;
        left:70%;
        height: 20%
    }
    .info_q{
        position:absolute;
        right:50%;
    }
    #first{
    }
    </style>
    <script src="https://cdn.bootcss.com/echarts/3.5.4/echarts.min.js"></script>
    </script>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js">
    </script>
    </meta>
</head>

<body>
    <div class="title">
        基于异构网络的top-k子图匹配算法
    </div>
    <div>
        <br/>
        <br/>
    </div>
    <div style="width: 1300px;height:200px;position:relative;left:20%;height: 20%">
        <label for="g">
              数据图 G：
        </label>
        <select id="g">
            <option value="./static/1k2k.json">
                1k2k.json
            </option>
            <option value="./static/3k5k.json">
                3k5k.json
            </option>
            <option value="./static/5k9k.json">
                5k9k.json
            </option>
            <option value="./static/8k13k.json">
                8k13k.json
            </option>
            <option value="./static/13k29k.json">
                13k29k.json
            </option>
        </select>
        <label for="ql">
            查询图 Q：
        </label>
        <select id="q">
            <option value="graph1">
                1-简单图
            </option>
            <option value="graph2">
                2-多重循环图
            </option>
            <option value="graph3">
                3-简单图加长
            </option>
        </select>
        <label for="q">
            是否执行过滤：
        </label>
        <select id="filterFlag">
            <option value="1">
                过滤
            </option>
            <option value="0">
                不过滤
            </option>
        </select>
        <label for="k" >
            选取top:
        </label>
        <input id="k" name="k" type="text" value="6">
        <button id="button">
            运行
        </button>
        <button id = 'mutil_button'>
            并行计算
        </button>
        </input>
    </div>
    <div id = 'first' style = "width: 900px;height:300px;"  class="first">
        <div id='graph_q' className = "show_q" style = "width: 500px;height:300px;top:20%;left:30%">   
  
        </div>
        <div class= 'info_q' style = "width: 400px;height:300px;top:50%;right:10%">
        <p id = 'node_num'>  </p> 
        <p id = 'calc_time'></p>
        <p id = 'num'></p>
         </div>
    </div>
    <div id="charts">
    </div>
    <!-- 为ECharts准备一个具备大小（宽高）的Dom -->
    <!-- <div id="main" style="width: 600px;height:400px;">
        </div> -->
    <script type="text/javascript">
    var showChart = function(content_json, k) {
        content_json = JSON.parse(content_json);
        var graph_q = document.getElementById("graph_q");
        var info_q = document.getElementById("calc_time");
        info_q.innerText = '计算耗时：'+content_json['calc_time'];
        var myChart_q = echarts.init(graph_q);
        myChart_q.showLoading();
        myChart_q.hideLoading();
        var nodes_q = content_json['graph_q']['nodes']
        var links_q = content_json['graph_q']['edges']
        var categories_q = [
                {
                    name: 'Author'
                },{
                    name: 'Paper'
                }
            ];
        option = {
                title: {
                    text: 'Query Graph',
                    top: 'center',
                    left: 'left'
                },
                tooltip: {},
                legend: [{
                    data: categories_q.map(function(a) {
                        return a.name;
                    })
                }],
                animationDuration: 100,
                animationEasingUpdate: 'quinticInOut',
                series: [{
                    name: 'query graph',
                    type: 'graph',
                    layout: 'circular',
                    data: nodes_q,
                    links: links_q,
                    categories: categories_q,
                    roam: true,
                    label: {
                        normal: {
                            position: 'right',
                            formatter: '{b}'
                        }
                    },
                    lineStyle: {
                        normal: {
                            color: 'source',
                            curveness: 0.3
                        }
                    }
                }]
            };
            myChart_q.setOption(option);
//--===================top-k=================-------
        var charts = document.getElementById("charts");
        charts.innerHTML = '';
        for (var i = 0; i < k; i++) {
        
            var id = 'chart' + i;
            var div = document.createElement('div');
            div.id = id
            div.className = "chart";
            div.style = "width: 330px;height:330px;";
            charts.append(div);
            var myChart = echarts.init(document.getElementById(id));
            myChart.showLoading();
             myChart.hideLoading();
            // 指定图表的配置项和数据---------------------
            graph = content_json.matched_graphs[i];
            var nodes = [];
            var tmp_nodes = [];
            var links = [];
            var categories = [
                {
                    name: 'Paper'
                },{
                    name: 'Author'
                }
            ];
           
            nodes = graph.node;
            links = graph.links;
            option = {
                title: {
                    text: 'Matched Graph '+(i+1),
                    subtext: '123',
                    top: 'bottom',
                    left: 'center'
                },
                tooltip: {},
                legend: [{
                    data: categories.map(function(a) {
                        return a.name;
                    })
                }],
                animationDuration: 100,
                animationEasingUpdate: 'quinticInOut',
                series: [{
                    name: 'match',
                    type: 'graph',
                    layout: 'circular',
                    data: nodes,
                    links: links,
                    categories: categories,
                    roam: true,
                    label: {
                        normal: {
                            position: 'right',
                            formatter: '{b}'
                        }
                    },
                    lineStyle: {
                        normal: {
                            color: 'source',
                            curveness: 0.3
                        }
                    }
                }]
            };
            myChart.setOption(option);
        }

    }
    var button = document.getElementById("button");
    button.onclick = function() {
        var k = document.getElementById("k").value;
        var g = document.getElementById("g").value;
        var q = document.getElementById("q").value;
        var filterFlag = document.getElementById("filterFlag").value;
        $.ajax({
            url: '/match_graph',
            method: 'POST',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({
                'k': k,
                'g': g,
                'q': q,
                'filterFlag': filterFlag
            }),
            success: function(ret) {
                showChart(ret, k);
            }
        })
    }
    var mutil_button = document.getElementById('mutil_button');
    mutil_button.onclick = function(){
        var k = document.getElementById("k").value;
        var g = document.getElementById("g").value;
        var q = document.getElementById("q").value;
        var filterFlag = document.getElementById("filterFlag").value;
        $.ajax({
            url: '/mutil',
            method: 'POST',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({
                'k': k,
                'g': g,
                'q': q,
                'filterFlag': filterFlag
            }),
            success: function(ret) {
                showChart(ret, k);
            }
        })
    }
    </script>
</body>

</html>
